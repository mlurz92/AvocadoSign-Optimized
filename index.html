<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AvocadoSign T2 Analyse v2.4.0-optimized</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•ë</text></svg>">
</head>
<body>
    <div id="loading-indicator">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Laden...</span>
        </div>
        <p class="mt-2">Anwendung wird geladen...</p>
    </div>

    <div id="app-container" class="d-none">
        <header class="bg-light shadow-sm sticky-top">
            <div class="container-fluid px-md-4 py-2">
                <div class="d-flex flex-wrap align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <h1 class="h5 mb-0 me-3 text-primary app-title">
                            <span class="app-icon me-1">ü•ë</span>AvocadoSign T2 Analyse
                        </h1>
                        <button id="kurzanleitung-button" class="btn btn-sm btn-outline-secondary p-0 px-1 border-0" data-tippy-content="Kurzanleitung & Wichtige Hinweise anzeigen">
                            <i class="fas fa-question-circle"></i>
                        </button>
                    </div>
                    <div id="kollektiv-buttons-container" class="btn-group btn-group-sm mt-2 mt-md-0" role="group" aria-label="Kollektiv Auswahl">
                        <button type="button" class="btn btn-outline-primary" data-kollektiv="Gesamt" data-tippy-content="Gesamtes Patientenkollektiv (N=106) analysieren.">Gesamt</button>
                        <button type="button" class="btn btn-outline-primary" data-kollektiv="direkt OP" data-tippy-content="Nur Patienten mit prim√§rer Operation (N=29) analysieren.">Direkt OP</button>
                        <button type="button" class="btn btn-outline-primary" data-kollektiv="nRCT" data-tippy-content="Nur Patienten nach neoadjuvanter Radiochemotherapie (N=77) analysieren.">nRCT</button>
                    </div>
                </div>
                <hr class="my-2 d-none d-md-block">
                <div id="header-stats-container" class="row gx-2 text-center small d-none d-md-flex">
                    <div class="col" data-tippy-content="Aktuell ausgew√§hltes Patientenkollektiv.">Kollektiv: <strong id="header-kollektiv">--</strong></div>
                    <div class="col" data-tippy-content="Gesamtzahl der Patienten im ausgew√§hlten Kollektiv.">Patienten: <strong id="header-anzahl-patienten">--</strong></div>
                    <div class="col" data-tippy-content="N-Status Verteilung (Pathologie Referenz).">N-Status (Patho): <strong id="header-status-n">--</strong></div>
                    <div class="col" data-tippy-content="Avocado Sign Verteilung.">AS-Status: <strong id="header-status-as">--</strong></div>
                    <div class="col" data-tippy-content="T2-Status Verteilung (basierend auf aktuell angewendeten Kriterien).">T2-Status (angew.): <strong id="header-status-t2">--</strong></div>
                </div>
            </div>
        </header>

        <main class="container-fluid px-md-4 mt-3">
            <ul class="nav nav-tabs mb-3" id="main-tabs" role="tablist">
                <li class="nav-item" role="presentation"><button class="nav-link" id="daten-tab" data-bs-toggle="tab" data-bs-target="#daten-tab-pane" type="button" role="tab" aria-controls="daten-tab-pane" aria-selected="false">Daten</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="auswertung-tab" data-bs-toggle="tab" data-bs-target="#auswertung-tab-pane" type="button" role="tab" aria-controls="auswertung-tab-pane" aria-selected="false">Auswertung & Optimierung</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="statistik-tab" data-bs-toggle="tab" data-bs-target="#statistik-tab-pane" type="button" role="tab" aria-controls="statistik-tab-pane" aria-selected="false">Statistik</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="praesentation-tab" data-bs-toggle="tab" data-bs-target="#praesentation-tab-pane" type="button" role="tab" aria-controls="praesentation-tab-pane" aria-selected="false">Pr√§sentation</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="publikation-tab" data-bs-toggle="tab" data-bs-target="#publikation-tab-pane" type="button" role="tab" aria-controls="publikation-tab-pane" aria-selected="false">Publikation</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="export-tab" data-bs-toggle="tab" data-bs-target="#export-tab-pane" type="button" role="tab" aria-controls="export-tab-pane" aria-selected="false">Export</button></li>
            </ul>

            <div class="tab-content" id="main-tab-content">
                <div class="tab-pane fade" id="daten-tab-pane" role="tabpanel" aria-labelledby="daten-tab" tabindex="0">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">Patientendaten√ºbersicht</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="daten-toggle-details" data-action="expand" data-tippy-content="Alle Details ein-/ausblenden (T2 Lymphknotenmerkmale).">Alle Details Einblenden <i class="fas fa-chevron-down ms-1"></i></button>
                    </div>
                    <div class="table-responsive data-table-container">
                        <table class="table table-sm table-hover table-striped table-bordered small" id="daten-table">
                            <thead class="table-light sticky-top" style="z-index: 100;" id="daten-table-header">
                                <tr>
                                    <th scope="col" class="sortable" data-sort-key="nr" data-tippy-content="Sortieren nach Patienten-Nr.">Nr. <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="name" data-tippy-content="Sortieren nach Name.">Name <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="vorname" data-tippy-content="Sortieren nach Vorname.">Vorname <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="geschlecht" data-tippy-content="Sortieren nach Geschlecht.">Geschlecht <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="alter" data-tippy-content="Sortieren nach Alter.">Alter <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="therapie" data-tippy-content="Sortieren nach Therapie.">Therapie <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable text-center" data-sort-key="status" data-tippy-content="Sortieren nach Status (Kombiniert N, AS, T2). Klick auf N, AS oder T2 f√ºr Sub-Sortierung.">
                                        N<span class="sortable-sub-header" data-sub-key="n" data-tippy-content="Sortieren nach N-Status (Pathologie)."> (P)</span> /
                                        AS<span class="sortable-sub-header" data-sub-key="as" data-tippy-content="Sortieren nach AS-Status (Avocado Sign)."> (A)</span> /
                                        T2<span class="sortable-sub-header" data-sub-key="t2" data-tippy-content="Sortieren nach T2-Status (angew. Kriterien)."> (T)</span>
                                        <i class="fas fa-sort text-muted opacity-50 ms-1"></i>
                                    </th>
                                    <th scope="col" class="sortable" data-sort-key="bemerkung" data-tippy-content="Sortieren nach Bemerkung.">Bemerkung <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="text-center" style="width: 30px;"><i class="fas fa-ellipsis-h"></i></th>
                                </tr>
                            </thead>
                            <tbody id="daten-table-body"></tbody>
                        </table>
                    </div>
                    <div id="daten-pagination-container" class="mt-2 d-flex justify-content-center"></div>
                </div>

                <div class="tab-pane fade" id="auswertung-tab-pane" role="tabpanel" aria-labelledby="auswertung-tab" tabindex="0">
                    <div id="auswertung-t2-kriterien-controls-container" class="mb-3"></div>
                    <div id="t2-metrics-overview-container" class="mb-3"></div>
                    <div id="brute-force-container" class="mb-3"></div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">Auswertungsergebnisse pro Patient</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="auswertung-toggle-details" data-action="expand" data-tippy-content="Alle Details ein-/ausblenden (T2 Lymphknotenbewertung).">Alle Details Einblenden <i class="fas fa-chevron-down ms-1"></i></button>
                    </div>
                    <div class="table-responsive data-table-container">
                        <table class="table table-sm table-hover table-striped table-bordered small" id="auswertung-table">
                             <thead class="table-light sticky-top" style="z-index: 100;" id="auswertung-table-header">
                                <tr>
                                    <th scope="col" class="sortable" data-sort-key="nr" data-tippy-content="Sortieren nach Patienten-Nr.">Nr. <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="name" data-tippy-content="Sortieren nach Name.">Name <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable" data-sort-key="therapie" data-tippy-content="Sortieren nach Therapie.">Therapie <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable text-center" data-sort-key="status" data-tippy-content="Sortieren nach Status (Kombiniert N, AS, T2). Klick auf N, AS oder T2 f√ºr Sub-Sortierung.">
                                        N<span class="sortable-sub-header" data-sub-key="n" data-tippy-content="Sortieren nach N-Status (Pathologie)."> (P)</span> /
                                        AS<span class="sortable-sub-header" data-sub-key="as" data-tippy-content="Sortieren nach AS-Status (Avocado Sign)."> (A)</span> /
                                        T2<span class="sortable-sub-header" data-sub-key="t2" data-tippy-content="Sortieren nach T2-Status (angew. Kriterien)."> (T)</span>
                                        <i class="fas fa-sort text-muted opacity-50 ms-1"></i>
                                    </th>
                                    <th scope="col" class="sortable text-center" data-sort-key="anzahl_patho_lk" data-tippy-content="Sortieren nach Anzahl pathologischer Lymphknoten (N+/N ges.).">N+/N ges. (Patho) <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable text-center" data-sort-key="anzahl_as_lk" data-tippy-content="Sortieren nach Anzahl AS-positiver Lymphknoten (AS+/AS ges.).">AS+/AS ges. (T1KM) <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="sortable text-center" data-sort-key="anzahl_t2_lk" data-tippy-content="Sortieren nach Anzahl T2-positiver Lymphknoten (T2+/T2 ges. - angew. Kriterien).">T2+/T2 ges. (T2w) <i class="fas fa-sort text-muted opacity-50 ms-1"></i></th>
                                    <th scope="col" class="text-center" style="width: 30px;"><i class="fas fa-ellipsis-h"></i></th>
                                </tr>
                            </thead>
                            <tbody id="auswertung-table-body"></tbody>
                        </table>
                    </div>
                     <div id="auswertung-pagination-container" class="mt-2 d-flex justify-content-center"></div>
                </div>

                <div class="tab-pane fade" id="statistik-tab-pane" role="tabpanel" aria-labelledby="statistik-tab" tabindex="0">
                    <div id="statistik-controls-container" class="mb-3"></div>
                    <div id="statistik-results-container" class="row g-3">
                         <div id="statistik-spinner" class="text-center mt-5 d-none">
                            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">Statistiken werden berechnet...</span>
                            </div>
                            <p class="mt-2">Statistiken werden berechnet...</p>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="praesentation-tab-pane" role="tabpanel" aria-labelledby="praesentation-tab" tabindex="0">
                    <div id="praesentation-controls-container" class="mb-3"></div>
                    <div id="praesentation-results-container">
                        <div id="praesentation-spinner" class="text-center mt-5 d-none">
                            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">Pr√§sentationsdaten werden geladen...</span>
                            </div>
                             <p class="mt-2">Pr√§sentationsdaten werden geladen...</p>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="publikation-tab-pane" role="tabpanel" aria-labelledby="publikation-tab" tabindex="0">
                    <div id="publikation-spinner" class="text-center mt-5 d-none">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Publikationsdaten werden geladen...</span>
                        </div>
                        <p class="mt-2">Publikationsdaten werden geladen...</p>
                    </div>
                </div>

                <div class="tab-pane fade" id="export-tab-pane" role="tabpanel" aria-labelledby="export-tab" tabindex="0">
                    <div id="export-options-container"></div>
                </div>
            </div>
        </main>

        <footer class="container-fluid text-center text-muted small py-3 mt-4 border-top">
            AvocadoSign T2 Analyse-Tool v<span id="app-version-footer">2.4.0-optimized</span> | &copy; 2023-2025 | Optimiert f√ºr Forschungszwecke
        </footer>
    </div>

    <div class="modal fade" id="kurzanleitung-modal" tabindex="-1" aria-labelledby="kurzanleitungModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="kurzanleitungModalLabel"><i class="fas fa-info-circle me-2"></i> Kurzanleitung & Wichtige Hinweise</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schlie√üen"></button>
                </div>
                <div class="modal-body" id="kurzanleitung-modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schlie√üen</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="brute-force-modal" tabindex="-1" aria-labelledby="bruteForceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bruteForceModalLabel"><i class="fas fa-list-ol me-2"></i> Details Brute-Force Optimierung</h5>
                    <button class="btn btn-sm btn-outline-secondary ms-auto me-2" id="export-bruteforce-modal-txt" data-tippy-content="Detaillierten Bericht dieser Top-Ergebnisse als Textdatei (.txt) herunterladen.">
                        <i class="fas fa-file-alt me-1"></i> Exportieren
                    </button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schlie√üen"></button>
                </div>
                <div class="modal-body" id="brute-force-modal-body">
                    <p class="text-muted">Lade Ergebnisse...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schlie√üen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 2050;"></div>

    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.7/dist/tippy-bundle.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script src="data/data.js"></script>

    <script src="js/config/app_config.js"></script>
    <script src="js/config/text_config.js"></script>
    <script src="js/config/publication_config.js"></script>
    <script src="js/config/radiology_format_config.js"></script>

    <script src="js/utils/utils.js"></script>
    <script src="js/utils/radiology_formatter.js"></script>
    <script src="js/utils/citation_manager.js"></script>

    <script src="js/core/data_processor.js"></script>
    <script src="js/core/t2_criteria_manager.js"></script>
    <script src="js/core/study_criteria_manager.js"></script>

    <script src="js/services/statistics_service.js"></script>
    <script src="js/services/brute_force_manager.js"></script>
    <script src="js/services/export_service.js"></script>

    <script src="js/ui/core/ui_helpers.js"></script>
    <script src="js/ui/core/ui_components.js"></script>
    <script src="js/ui/core/pagination_manager.js"></script>

    <script src="js/ui/renderers/table_renderer.js"></script>
    <script src="js/ui/renderers/chart_renderer.js"></script>
    <script src="js/ui/renderers/publication_text_generator.js"></script>
    <script src="js/ui/renderers/publication_renderer.js"></script>

    <script src="js/ui/view_logic/data_tab_logic.js"></script>
    <script src="js/ui/view_logic/auswertung_tab_logic.js"></script>
    <script src="js/ui/view_logic/statistik_tab_logic.js"></script>
    <script src="js/ui/view_logic/praesentation_tab_logic.js"></script>
    <script src="js/ui/view_logic/publikation_tab_logic.js"></script>

    <script src="js/ui/view_renderer.js"></script>

    <script src="js/ui/event_handlers/general_event_handlers.js"></script>
    <script src="js/ui/event_handlers/auswertung_event_handlers.js"></script>
    <script src="js/ui/event_handlers/statistik_event_handlers.js"></script>
    <script src="js/ui/event_handlers/praesentation_event_handlers.js"></script>
    <script src="js/ui/event_handlers/publikation_event_handlers.js"></script>

    <script src="js/app/state.js"></script>
    <script src="js/app/main.js"></script>
</body>
</html>
