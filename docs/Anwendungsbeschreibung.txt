Anwendungsbeschreibung: Lymphknoten T2 - Avocado Sign Analyse-Tool v2.5.0

==================================================
1. Einleitung und Zielsetzung
==================================================
Version: 2.5.0 (Optimierte Version)

Das "Lymphknoten T2 - Avocado Sign Analyse-Tool" ist eine interaktive, webbasierte Anwendung, die für die wissenschaftliche Untersuchung und den Vergleich der diagnostischen Güte des Avocado Signs gegenüber verschiedenen morphologischen T2-Kriterien bei der MRT-basierten Lymphknotenbeurteilung des Rektumkarzinoms entwickelt wurde.
Ziel der Anwendung ist es, Forschern eine Plattform zu bieten, um:
-   Einen anonymisierten Patientendatensatz zu explorieren.
-   Flexible Definitionen von T2-Kriterien zu testen und anzuwenden.
-   Die Performance dieser Kriterien im Vergleich zum Avocado Sign und Literaturstandards statistisch fundiert zu bewerten.
-   Datengetrieben optimale T2-Kriteriensets zu identifizieren (Brute-Force-Optimierung).
-   Die Erstellung wissenschaftlicher Publikationen durch dynamisch generierte Textentwürfe und exportierbare Ergebnisse zu unterstützen.

Diese Version 2.5.0 stellt eine umfassend optimierte Fassung dar, mit erweitertem Funktionsumfang, verbesserter Benutzerfreundlichkeit, tiefergehenden statistischen Analysen und einer robusteren technischen Architektur.

==================================================
2. Allgemeine Bedienung
==================================================
Die Anwendung ist in mehrere Tabs unterteilt, die spezifische Funktionen bereitstellen.

2.1. Globaler Header:
-   **App-Titel:** Zeigt den Namen und die Version der Anwendung.
-   **Kollektiv-Übersicht:** Zeigt dynamisch das aktuell ausgewählte Patientenkollektiv, die Gesamtpatientenzahl sowie die prozentualen Anteile N+, AS+ und T2+ für dieses Kollektiv.
-   **Kurzanleitung-Button (Fragezeichen-Icon):** Öffnet ein modales Fenster mit einer kompakten Bedienungsanleitung und wichtigen Hinweisen.
-   **Kollektiv-Auswahl-Buttons ("Gesamt", "Direkt OP", "nRCT"):** Ermöglichen die Auswahl des globalen Patientenkollektivs, das für die meisten Analysen und Darstellungen in der Anwendung verwendet wird. Eine Änderung hier aktualisiert alle relevanten Ansichten.

2.2. Tab-Navigation:
Unterhalb des Headers befindet sich die Hauptnavigation, die den Zugriff auf die verschiedenen Funktionsbereiche (Tabs) ermöglicht: Daten, Auswertung, Statistik, Präsentation, Publikation, Export. Der aktive Tab ist hervorgehoben.

2.3. Tooltips:
Viele Elemente der Benutzeroberfläche (Buttons, Eingabefelder, Spaltenüberschriften, statistische Kennzahlen) sind mit Tooltips versehen. Fahren Sie mit der Maus über ein Element, um detailliertere Erklärungen oder Interpretationshilfen zu erhalten.

==================================================
3. Tab-spezifische Funktionen
==================================================

3.1. Daten-Tab:
-   **Anzeige:** Listet alle Patienten des aktuell ausgewählten globalen Kollektivs mit Basisinformationen (Nr., Name, Geschlecht, Alter, Therapie) und dem jeweiligen Status für N (Pathologie), AS (Avocado Sign) und T2 (gemäß aktuell angewendeten Kriterien).
-   **Sortierung:** Alle Spalten sind durch Klick auf die Spaltenüberschrift sortierbar (auf-/absteigend). Ein Pfeil-Icon zeigt die aktuelle Sortierung an. Für die Spalte "N/AS/T2" kann durch Klick auf die Sub-Header (N, AS, T2) eine Sub-Sortierung erfolgen.
-   **Aufklappbare Details:** Patienten mit verfügbaren T2-Lymphknotendaten haben ein Pfeil-Icon in der ersten Spalte. Ein Klick darauf (oder auf die Zeile) klappt eine Detailansicht mit den morphologischen Eigenschaften jedes T2-bewerteten Lymphknotens dieses Patienten aus.

3.2. Auswertung-Tab:
Dieser Tab ist zentral für die Definition von T2-Kriterien und die Durchführung der Brute-Force-Optimierung.
    3.2.1. T2-Malignitätskriterien definieren:
    -   **Logische Verknüpfung:** Auswahl zwischen "UND" (alle aktiven Kriterien müssen für einen positiven LK erfüllt sein) und "ODER" (mindestens ein aktives Kriterium muss erfüllt sein).
    -   **Kumulative Logikanzeige:** Eine dynamische Textanzeige verdeutlicht die aktuell konstruierte logische Regel basierend auf aktivierten Kriterien und der gewählten Logik.
    -   **Einzelkriterien:** Für jedes T2-Merkmal (Größe, Form, Kontur, Homogenität, Signal) kann:
        * Das Kriterium mittels eines Schalters aktiviert/deaktiviert werden. Deaktivierte Kriterien gehen nicht in die Bewertung ein. Die UI zeigt klar den Aktivitätsstatus.
        * Der spezifische Wert bzw. Schwellenwert definiert werden (z.B. Größe >= 5mm, Form=rund).
    -   **Vordefinierte Sets laden:** Ein Dropdown-Menü ermöglicht das schnelle Laden von T2-Kriteriensets, die in relevanten Literaturstudien beschrieben wurden. Geladene Sets können anschließend angepasst werden.
    -   **Buttons:**
        * "Anwenden & Speichern": Übernimmt die aktuellen Einstellungen für T2-Kriterien und Logik, wendet sie auf den gesamten Datensatz an und speichert sie für die aktuelle Sitzung (im Local Storage). Alle relevanten Ansichten (Auswertungstabelle, Dashboard, Statistik-Tab etc.) werden aktualisiert. Ein Indikator zeigt ungespeicherte Änderungen an.
        * "Zurücksetzen": Setzt alle T2-Kriterien und die Logik auf die Standardwerte der Anwendung zurück.

    3.2.2. Brute-Force T2-Kriterien Optimierung:
    -   **Zielmetrik:** Auswahl der diagnostischen Metrik (Accuracy, Balanced Accuracy (Standard), F1-Score, PPV, NPV), die durch die Optimierung maximiert werden soll.
    -   **Steuerung:**
        * "Optimierung starten": Beginnt die Brute-Force-Suche im aktuellen globalen Kollektiv. Der Fortschritt wird angezeigt. Die UI bleibt währenddessen bedienbar, da die Berechnung in einem Web Worker erfolgt.
        * "Abbrechen": Stoppt eine laufende Optimierung.
    -   **Ergebnisanzeige:**
        * Zeigt das beste gefundene Kriterienset und den erreichten Wert der Zielmetrik für das aktuelle Kollektiv an.
        * "Details anzeigen"-Button: Öffnet ein modales Fenster mit den Top-10 (und gleichwertigen) gefundenen Kriterienkombinationen. Für jede Kombination werden die Logik, die Kriterien, der Wert der Zielmetrik, die **vollständige 4-Felder-Tafel (RP, FP, FN, RN)** sowie die daraus abgeleiteten Metriken (Sensitivität, Spezifität, PPV, NPV, Accuracy, Balanced Accuracy, F1-Score) angezeigt.
        * Export-Buttons im Modal: Ermöglichen den Export des detaillierten Berichts (Top-Ergebnisse) als TXT und aller getesteten Kombinationen mit ihren Metriken als CSV.

    3.2.3. Dashboard (Kurzübersicht):
    -   Zeigt Kacheln mit den wichtigsten diagnostischen Gütekriterien (Sensitivität, Spezifität, Accuracy, Balanced Accuracy) für die aktuell **angewendeten und gespeicherten** T2-Kriterien im Vergleich zum N-Status für das global gewählte Kollektiv.

    3.2.4. Patientenauswertungstabelle:
    -   Listet alle Patienten des aktuellen Kollektivs.
    -   Spalten: Nr., Name, Therapie, N-Status, AS-Status, T2-Status (basierend auf angewendeten Kriterien), sowie detaillierte Lymphknotenzahlen (N gesamt/positiv, AS gesamt/positiv, T2 gesamt/positiv).
    -   Sortierbar und mit aufklappbaren Details zu den bewerteten T2-Lymphknoten jedes Patienten, inklusive der Erfüllung der einzelnen aktiven Kriterien.

3.3. Statistik-Tab:
Bietet detaillierte statistische Analysen.
    -   **Layout-Auswahl:**
        * "Einzelnes Kollektiv": Analysen für das global im Header gewählte Kollektiv.
        * "Kollektivvergleich": Auswahl zweier spezifischer Kollektive für einen direkten Vergleich ihrer Statistiken.
    -   **Deskriptive Statistik:**
        * Tabellarische Zusammenfassung von Patientencharakteristika (Alter, Geschlecht, Therapie, Statusverteilungen, Lymphknotenzahlen).
        * Diagramme: Altersverteilung (Histogramm), Geschlechterverteilung (Tortendiagramm).
    -   **Diagnostische Güte (für Avocado Sign und aktuell angewandte T2-Kriterien):**
        * Separate Abschnitte für AS und T2.
        * Tabellen mit Sensitivität, Spezifität, PPV, NPV, Accuracy, Balanced Accuracy, F1-Score, AUC, **Positivem Likelihood Ratio (LR+) und Negativem Likelihood Ratio (LR-)**, jeweils mit 95% Konfidenzintervallen und Angabe der CI-Methode.
        * **Interaktive ROC-Kurven:** Anzeige der ROC-Kurve mit Mouseover-Effekten für Datenpunkte (Anzeige von Schwelle, Sens, Spez). Der aktuell gewählte Arbeitspunkt (falls anwendbar) oder ein optimaler Cut-Off (z.B. Youden-Index) wird hervorgehoben. Der AUC-Wert mit 95%-CI wird direkt im Diagramm angezeigt.
    -   **Statistischer Vergleich (AS vs. angewandte T2-Kriterien):**
        * Tabelle mit Ergebnissen des McNemar-Tests (für Accuracy-Unterschiede) und des DeLong-Tests (für AUC-Unterschiede).
    -   **Assoziationsanalysen:**
        * Untersucht den Zusammenhang zwischen dem pathologischen N-Status und dem AS-Status bzw. der Erfüllung einzelner (aktiver) T2-Merkmale.
        * Berechnung von Odds Ratios (OR), Risk Differences (RD) mit 95%-CIs und dem Phi-Koeffizienten.
        * Signifikanztests (z.B. Fisher's Exact Test).
        * **Forest-Plots:** Grafische Darstellung der ORs und/oder RDs mit ihren CIs für ausgewählte Merkmale.
    -   **Explorative Lymphknoten-Ebene Analyse:**
        * Deskriptive Statistiken für alle T2-sichtbaren Lymphknoten (z.B. mittlere Größe, Verteilung von Form, Kontur etc.), stratifiziert nach dem N-Status des Patienten (N+ vs. N-).
    -   **Vergleich verschiedener Kriteriensets (Tabelle):**
        * Eine Übersichtstabelle vergleicht die diagnostische Performance (Sens, Spez, PPV, NPV, Acc, AUC/BalAcc) des Avocado Signs, der aktuell angewandten T2-Kriterien und relevanter Literatur-Kriteriensets. Die Literatur-Sets werden dabei auf ihrem ursprünglichen Zielkollektiv (falls abweichend vom global gewählten) evaluiert und dies wird kenntlich gemacht.

3.4. Präsentation-Tab:
Stellt Analyseergebnisse in einem aufbereiteten, vortragsfreundlichen Format dar.
    -   **Ansichtsauswahl:**
        * "Avocado Sign (Performance)": Übersicht der AS-Performance in allen drei Kollektiven (Gesamt, Direkt-OP, nRCT).
        * "AS vs. T2 (Vergleich)": Direkter Vergleich von AS mit einer auswählbaren T2-Kriterienbasis.
    -   **T2-Vergleichsbasis Auswahl (nur in "AS vs. T2" Ansicht):**
        * Dropdown zur Auswahl der T2-Kriterien, die mit AS verglichen werden sollen (aktuell in der App eingestellte Kriterien oder vordefinierte Sets aus Literaturstudien).
        * Bei Auswahl eines Literatur-Sets passt sich das für den Vergleich verwendete Patientenkollektiv ggf. an das Zielkollektiv der jeweiligen Studie an.
    -   **Informationskarten:** Details zur gewählten T2-Vergleichsbasis (Referenz, Kohorte, Kriterien).
    -   **Vergleichstabellen und -diagramme:** Numerische und grafische Gegenüberstellung von AS und der gewählten T2-Basis.
    -   **Exportfunktionen:** Direkter Export der angezeigten Tabellen (CSV, Markdown) und Diagramme (PNG, SVG).

3.5. Publikation-Tab (stark erweitert):
Dieses Modul unterstützt massiv bei der Erstellung eines wissenschaftlichen Manuskripts.
    -   **Sprachauswahl:** Deutsch / Englisch für die generierten Texte.
    -   **Brute-Force Metrik-Auswahl:** Auswahl, auf welcher optimierten Brute-Force-Metrik die Ergebnisdarstellungen (für optimierte T2-Kriterien) basieren sollen.
    -   **Sektionsnavigation (Sidebar):** Gliederung analog zu einer wissenschaftlichen Publikation (z.B. Einleitung, Methoden, Ergebnisse, Diskussion, Abstract, Referenzen), unterteilt in detaillierte Unterabschnitte.
    -   **Inhaltsbereich:**
        * Dynamische Generierung von **ausführlichen Textentwürfen** für die ausgewählte Sektion.
        * Die Texte orientieren sich in Aufbau, Detaillierungsgrad und wissenschaftlicher Sprache stark an den **vier bereitgestellten PDF-Originalarbeiten** (Lurz & Schäfer 2025, Koh et al. 2008, Barbaro et al. 2024, Rutegård et al. 2025 / ESGAR 2016).
        * **Fokus der neuen Publikation:** Vergleich des Avocado Signs mit etablierten Literatur-T2-Kriterien und mit datengetrieben (Brute-Force) optimierten T2-Kriterien.
        * **Detaillierte Methodenbeschreibung:** Umfasst Patientenkollektive, Ein-/Ausschlusskriterien, MRT-Protokoll, Definitionen von AS und den verschiedenen T2-Sets, Referenzstandard und eine genaue Beschreibung der statistischen Methoden (inkl. verwendeter Tests, CI-Methoden).
        * **Umfassende Ergebnisdarstellung:** Beinhaltet Patientencharakteristika, detaillierte Performance-Metriken für AS, Literatur-T2-Sets und optimierte T2-Sets (jeweils für alle relevanten Kollektive), sowie vergleichende Analysen mit p-Werten.
        * **Dynamische Aktualisierung:** Die Texte reagieren sensitiv auf Änderungen in den globalen Einstellungen (z.B. angewandte T2-Kriterien für explorative Teile, gewählte Brute-Force-Zielmetrik).
        * **Platzhalter für Tabellen und Abbildungen:** Im generierten Text werden dynamisch Platzhalter (z.B. "{Table:Patientencharakteristika_Gesamt}", "{Figure:ROC_AS_Gesamt}") eingefügt, die im nächsten Schritt durch die entsprechenden HTML-Tabellen und Diagramme ersetzt werden.
    -   **Export:** Button zum Export aller generierten Sektionstexte als einzelne Markdown-Dateien, gebündelt in einem ZIP-Archiv.

3.6. Export-Tab:
Bietet umfangreiche Optionen zum Herunterladen von Daten und Ergebnissen.
    -   **Einzelexporte:**
        * Statistikübersicht (detailliert) als CSV.
        * Brute-Force-Bericht (Top-Ergebnisse) als TXT.
        * **Brute-Force Rohdaten (alle getesteten Kombinationen) als CSV.**
        * Ausgewählte Tabellen (Deskriptive Statistik, Datenliste, Auswertungstabelle) als Markdown.
        * Gefilterte Rohdaten des aktuellen Kollektivs als CSV.
        * Umfassender Analysebericht als HTML (inkl. Konfigurationen, Statistiken, eingebettete Diagramme).
    -   **Diagrammexport-Optionen:**
        * Auswahl der Auflösung (150, 300, 600 DPI) für PNG-Exporte.
        * Optionen für SVG-Exporte (z.B. Schrifteinbettung, Inline-Styles).
    -   **Export-Pakete (ZIP):**
        * Alle Einzeldateien (CSV, MD, TXT, HTML).
        * Alle CSV-Dateien.
        * Alle Markdown-Dateien (inkl. aller Publikationssektionen).
        * Alle aktuell sichtbaren Diagramme und ausgewählte Tabellen als PNGs.
        * Alle aktuell sichtbaren Diagramme als SVGs.
        * **"One-Click" Publikations-Chart-Paket:** Sammelt alle für den aktuellen Stand des Publikation-Tabs relevanten Diagramme (z.B. Patientencharakteristika, Performancevergleiche) und lädt sie als ZIP-Datei (enthält SVG und PNG Versionen jedes Diagramms) herunter.

==================================================
4. Technische Aspekte und Verbesserungen (v2.5.0)
==================================================
-   **Modulare Code-Struktur:** Der JavaScript-Code wurde stark modularisiert (Aufteilung in Services, Manager, Renderer, UI-Logik-Module), um die Lesbarkeit, Wartbarkeit und Testbarkeit zu verbessern.
-   **CSS-Refactoring:** Die CSS-Stile wurden in thematische Teildateien aufgeteilt und Farbvariablen sowie Abstände vereinheitlicht, was zukünftige Design-Anpassungen erleichtert.
-   **Verfeinertes State Management:** Klarere Abgrenzung von Zuständen und verbesserte Robustheit.
-   **Dynamisches Modul-Laden:** JavaScript-Module für UI-Logik der einzelnen Tabs werden erst bei Bedarf nachgeladen, um die initiale Ladezeit der Anwendung zu reduzieren.
-   **Performance-Optimierungen:** UI-Updates erfolgen gezielter, um eine flüssige Benutzererfahrung zu gewährleisten. Animationen sind dezent und unterstützen die Interaktion.

==================================================
5. Wichtiger Hinweis
==================================================
Das "Lymphknoten T2 - Avocado Sign Analyse-Tool" ist ein wissenschaftliches Forschungswerkzeug. Es ist **nicht** für den Einsatz in der klinischen Routine zur Diagnosestellung oder Therapieplanung bei einzelnen Patienten zugelassen oder vorgesehen. Alle Ergebnisse und Interpretationen müssen im Kontext der zugrundeliegenden Studienpopulation und Methodik betrachtet werden.
