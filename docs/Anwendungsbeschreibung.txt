=========================================================
Anwendungsbeschreibung: Avocado Sign Analyse Tool
Version: 2.3.0 (Stand: Mai 2025)
=========================================================

Inhaltsverzeichnis:
1. Einleitung und Zielsetzung
2. Datengrundlage
3. Technische Implementierung
4. Hauptfunktionen und Tab-Beschreibung
    4.1 Globaler Header
    4.2 Daten-Tab
    4.3 Auswertung-Tab
    4.4 Statistik-Tab
    4.5 Präsentation-Tab
    4.6 Publikation-Tab
    4.7 Export-Tab
5. Statistische Methoden im Detail
6. Bedienungshinweise
7. Geplante Erweiterungen und Limitationen

=========================================================
1. Einleitung und Zielsetzung
=========================================================

Das "Avocado Sign" ist ein neuartiger MRT-basierter Bildgebungsmarker, der auf kontrastmittelverstärkten T1-gewichteten Bildern zur Beurteilung des Lymphknotenstatus bei Patienten mit Rektumkarzinom identifiziert wurde (Lurz & Schäfer, 2025). Es zeichnet sich durch einen klar abgrenzbaren, hypointensen Kern innerhalb eines ansonsten homogen hyperintensen Lymphknotens aus.

Diese Webanwendung, das "Avocado Sign Analyse Tool", dient als interaktive Plattform für die umfassende Analyse und Validierung des Avocado Signs. Ursprünglich entwickelt für die explorative Datenanalyse und den Vergleich mit traditionellen T2-gewichteten morphologischen Kriterien, wurde die Anwendung nun signifikant erweitert und optimiert. Das Hauptziel dieser Optimierung ist die Unterstützung bei der Erstellung einer wissenschaftlichen Publikation zum Vergleich des Avocado Signs mit verschiedenen T2-Kriteriensets (literaturbasiert und datengetrieben optimiert) für das renommierte Fachjournal "Radiology".

Die Anwendung ermöglicht:
-   Die detaillierte Visualisierung und Exploration des zugrundeliegenden Patientendatensatzes.
-   Die flexible Definition und Anwendung verschiedener T2-gewichteter morphologischer Kriterien.
-   Eine automatisierte Brute-Force-Optimierung zur Identifikation der leistungsstärksten T2-Kriterienkombinationen.
-   Umfassende statistische Analysen zur diagnostischen Güte und zum Vergleich der verschiedenen Methoden.
-   Die Generierung von Textbausteinen, Tabellen und Diagramm-Platzhaltern im Stil und Format des Journals "Radiology".
-   Vielfältige Exportoptionen für Daten, Ergebnisse und Grafiken.

=========================================================
2. Datengrundlage
=========================================================

Die Anwendung basiert auf einem retrospektiv analysierten, prospektiv dokumentierten, monozentrischen Kollektiv von 106 konsekutiven Patienten mit histologisch gesichertem Rektumkarzinom. Diese Daten entsprechen dem Kollektiv der Originalpublikation zum Avocado Sign (Lurz & Schäfer, 2025).

Für jeden Patienten wurden folgende Daten erfasst und in die Anwendung integriert:
-   **Basisdaten:** Anonymisierte ID, Name, Vorname, Geburtsdatum, Untersuchungsdatum der MRT, Geschlecht.
-   **Klinische Informationen:** Therapiestatus (Direkt OP ohne Vorbehandlung vs. neoadjuvante Radiochemotherapie (nRCT) vor Operation).
-   **Histopathologischer Referenzstandard:** Der N-Status (N+ für mindestens einen positiven Lymphknoten, N0 für keine befallenen Lymphknoten) basierend auf der Untersuchung des Operationspräparats nach totaler mesorektaler Exzision (TME). Zusätzlich die Anzahl der untersuchten und der befallenen Lymphknoten pro Patient.
-   **Avocado Sign (AS) Status:** Bewertung jedes Patienten als AS-positiv oder AS-negativ basierend auf den T1-gewichteten Kontrastmittel-MRT-Bildern. Zusätzlich die Anzahl der sichtbaren und der AS-positiven Lymphknoten.
-   **T2-gewichtete MRT-Merkmale:** Für jeden sichtbaren mesorektalen Lymphknoten im T2-gewichteten MRT wurden folgende morphologische Kriterien erfasst:
    -   Größe (Kurzachsendurchmesser in mm)
    -   Form ('rund', 'oval')
    -   Kontur ('scharf' berandet, 'irregulär')
    -   Homogenität ('homogen', 'heterogen')
    -   Signalintensität ('signalarm', 'intermediär', 'signalreich') relativ zur umgebenden Muskulatur.
    Zusätzlich die Gesamtzahl der im T2-MRT bewerteten Lymphknoten pro Patient.

Die Rohdaten sind in `data/data.js` als JavaScript-Array von Objekten gespeichert.

=========================================================
3. Technische Implementierung
=========================================================

Die Anwendung ist eine reine Frontend-Webanwendung, geschrieben in Vanilla JavaScript (ES6+), HTML5 und CSS3. Sie läuft vollständig im Browser des Nutzers, ohne serverseitige Komponenten.

-   **Kerntechnologien:**
    -   HTML5 für die Grundstruktur.
    -   CSS3 (mit Bootstrap 5.3) für das Styling und responsive Layout.
    -   Vanilla JavaScript für die gesamte Anwendungslogik, Datenverarbeitung und DOM-Manipulation.

-   **Verwendete externe Bibliotheken:**
    -   **Bootstrap (v5.3.3):** Für das grundlegende UI-Framework, Grid-System, und UI-Komponenten (Tabs, Buttons, Modals, Toasts).
    -   **D3.js (v7.9.0):** Für die dynamische Erstellung und Manipulation von SVG-basierten Diagrammen (Balken-, Torten-, ROC-Kurven).
    -   **Tippy.js (v6):** Für erweiterte, anpassbare Tooltips. (Popper.js als Abhängigkeit).
    -   **PapaParse (v5.4.1):** Für das Parsen von CSV-Dateien (obwohl aktuell nicht für Import, sondern für CSV-Export-Generierung genutzt).
    -   **JSZip (v3.10.1):** Für das Erstellen von ZIP-Archiven für den Export mehrerer Dateien.
    -   **SheetJS (xlsx.full.min.js, v0.18.5):** Für das Erstellen von Excel-Dateien im XLSX-Format.
    -   **html-to-docx (v1.8.0):** Für die Konvertierung von HTML (generiert aus Markdown) in Microsoft Word (.docx) Dateien.
    -   **Marked (v4.3.0):** Für die Konvertierung von Markdown-Text in HTML (wird vor dem DOCX-Export verwendet).
    -   **html2canvas (v1.4.1):** Für die Erstellung von PNG-Bildern aus HTML-Tabellen.
    -   **Font Awesome (v5.15.4):** Für Icons.

-   **Architekturüberblick:** Die Anwendung ist modular aufgebaut:
    -   **`js/config/`:** Enthält Konfigurationsdateien für die Anwendung (`app_config.js`), UI-Texte (`text_config.js`) und spezifische Konfigurationen für den Publikationstab (`publication_config.js`).
    -   **`js/core/`:** Beinhaltet die Kernlogik für Datenverarbeitung (`data_processor.js`) und das Management der T2-Kriterien (benutzerdefiniert in `t2_criteria_manager.js`, studienbasiert in `study_criteria_manager.js`).
    -   **`js/services/`:** Stellt Dienste bereit wie statistische Berechnungen (`statistics_service.js`), Brute-Force-Optimierung (`brute_force_manager.js`) und Exportfunktionen (`export_service.js`).
    -   **`js/ui/core/`:** Enthält grundlegende UI-Helfer (`ui_helpers.js`) und Komponenten-Generatoren (`ui_components.js`).
    -   **`js/ui/renderers/`:** Verantwortlich für das Rendern spezifischer UI-Elemente wie Diagramme (`chart_renderer.js`) und Tabellen (`table_renderer.js`).
    -   **`js/ui/view_logic/`:** Enthält die spezifische Logik für jeden Haupt-Tab (z.B. `daten_tab_logic.js`, `auswertung_tab_logic.js`).
    -   **`js/ui/event_handlers/`:** Behandelt Benutzerinteraktionen für jeden Haupt-Tab und globale Events.
    -   **`js/features/publication/`:** Ein neues Verzeichnis, das alle spezifischen Module für den erweiterten Publikation-Tab bündelt (Logik, Renderer, Textgenerator, Komponenten, Utilities, Event-Handler).
    -   **`js/app/`:** Enthält den globalen Anwendungszustand (`state.js`) und das Hauptinitialisierungsskript (`main.js`).
    -   **`workers/`:** Beinhaltet den Web Worker für die Brute-Force-Optimierung (`brute_force_worker.js`), um die UI nicht zu blockieren.

Die Daten werden clientseitig gehalten und verarbeitet. Benutzereinstellungen und Zustände werden im Local Storage des Browsers persistiert.

=========================================================
4. Hauptfunktionen und Tab-Beschreibung
=========================================================

Die Anwendung ist in mehrere Tabs unterteilt, die jeweils spezifische Funktionalitäten bereitstellen.

---
**4.1 Globaler Header**
---

Der Header-Bereich ist immer sichtbar und bietet:
-   **App-Titel und Version:** Zeigt den Namen und die aktuelle Version der Anwendung.
-   **Kollektiv-Auswahl:** Buttons zur Auswahl des globalen Patientenkollektivs:
    -   `Gesamt`: Alle 106 Patienten.
    -   `Direkt OP`: Nur Patienten, die primär operiert wurden (N=29).
    -   `nRCT`: Nur Patienten, die neoadjuvant radiochemotherapiert wurden (N=77).
    Die Auswahl beeinflusst alle Analysen und Darstellungen in der gesamten Anwendung.
-   **Kurzanleitung:** Ein Button, der ein Modal mit einer Einführung in die Bedienung und wichtigen Hinweisen öffnet.
-   **Header-Statistiken:** Eine dynamische Anzeige der Anzahl der Patienten im aktuellen Kollektiv sowie der Verteilung des N-Status (Pathologie), AS-Status und des aktuell angewendeten T2-Status.

---
**4.2 Daten-Tab**
---

Dieser Tab dient der Anzeige und Exploration der Rohdaten des ausgewählten globalen Kollektivs.
-   **Patiententabelle:** Zeigt eine Liste aller Patienten mit Basisinformationen (Nr., Name, Geschlecht, Alter, Therapie), dem N/AS/T2-Status und Bemerkungen.
-   **Sortierung:** Alle Spalten (außer Bemerkung) sind sortierbar durch Klick auf den Spaltenkopf. Die Status-Spalte (N/AS/T2) erlaubt eine Sub-Sortierung nach N, AS oder T2.
-   **Paginierung:** Die Tabelle ist paginiert, um die Anzeige übersichtlich zu halten. Die Anzahl der Zeilen pro Seite ist konfigurierbar (`APP_CONFIG`).
-   **Detailansicht für T2-Lymphknoten:** Jede Patientenreihe kann aufgeklappt werden, um eine detaillierte Liste der morphologischen Eigenschaften (Größe, Form, Kontur, Homogenität, Signal) jedes einzelnen T2-gewichteten Lymphknotens dieses Patienten anzuzeigen. Die Darstellung erfolgt mit spezifischen Icons und Werten.

---
**4.3 Auswertung-Tab**
---

Dieser Tab ist das Kernstück für die Definition von T2-Kriterien, die Brute-Force-Optimierung und die Anzeige der resultierenden Auswertungstabelle.

-   **4.3.1 T2-Kriteriendefinition:**
    -   Ein interaktiver Bereich ermöglicht die Definition eines benutzerdefinierten T2-Malignitätskriteriensets.
    -   **Kriterien:** Für jedes der fünf morphologischen T2-Merkmale (Größe, Form, Kontur, Homogenität, Signal) kann der Nutzer:
        -   Das Kriterium aktivieren/deaktivieren.
        -   Für Größe: Einen Schwellenwert (Kurzachse in mm) mittels Slider oder direkter Eingabe festlegen (Bedingung ist immer ">=").
        -   Für Form, Kontur, Homogenität, Signal: Den als suspekt geltenden Wert aus einer Liste vordefinierter Optionen auswählen (z.B. Form='rund', Kontur='irregulär').
    -   **Logik:** Die Verknüpfung der aktiven Kriterien kann gewählt werden:
        -   `UND`: Ein Lymphknoten gilt nur als positiv, wenn ALLE aktivierten Kriterien erfüllt sind.
        -   `ODER`: Ein Lymphknoten gilt als positiv, wenn MINDESTENS EIN aktiviertes Kriterium erfüllt ist.
    -   **Aktionen:**
        -   `Zurücksetzen (Standard)`: Setzt alle Kriterien und die Logik auf die in `APP_CONFIG` definierten Standardwerte zurück.
        -   `Anwenden & Speichern`: Übernimmt die aktuellen Einstellungen als "angewandte Kriterien", speichert sie im Local Storage und aktualisiert alle abhängigen Ansichten und Statistiken in der gesamten Anwendung. Ein Indikator zeigt ungespeicherte Änderungen an.

-   **4.3.2 Dashboard:**
    -   Zeigt dynamisch aktualisierte deskriptive Statistiken und Diagramme für das aktuell im Header ausgewählte globale Kollektiv, basierend auf den **angewendeten** T2-Kriterien.
    -   **Karten:** N-Status Verteilung, AS-Status Verteilung, T2-Status Verteilung (angewandt).
    -   **Diagramme:** Altersverteilung (Histogramm), Geschlechterverteilung (Tortendiagramm), Therapieverteilung (Tortendiagramm).

-   **4.3.3 Kriterien-Optimierung (Brute-Force):**
    -   Ermöglicht die automatische Suche nach der optimalen T2-Kriterienkombination.
    -   **Zielmetrik:** Der Nutzer kann eine diagnostische Metrik auswählen (Accuracy, Balanced Accuracy, F1-Score, PPV, NPV), die maximiert werden soll.
    -   **Prozess:** Der Algorithmus (ausgeführt in einem Web Worker, um die UI nicht zu blockieren) testet systematisch eine große Anzahl von Kombinationen aus aktiven/inaktiven Kriterien, unterschiedlichen Größenschwellenwerten, verschiedenen Merkmalsausprägungen und den Logiken (UND/ODER).
    -   **Fortschrittsanzeige:** Zeigt den Fortschritt der Optimierung (getestete/gesamte Kombinationen, aktuell beste gefundene Metrik und Kriterien). Der Prozess kann abgebrochen werden.
    -   **Ergebnisdarstellung:** Nach Abschluss wird das beste gefundene Kriterienset (inkl. Logik und erreichtem Metrikwert) angezeigt.
        -   `Details (Top 10)`: Öffnet ein Modal mit einer Liste der Top-N besten gefundenen Kriterienkombinationen, inklusive ihrer individuellen Performance-Metriken (Sens, Spez, PPV, NPV, etc.). Dieser Bericht kann als TXT-Datei exportiert werden.
        -   `Anwenden`: Übernimmt das beste gefundene Kriterienset als aktuell definierte und angewandte T2-Kriterien in der gesamten Anwendung.

-   **4.3.4 Kurzübersicht Diagnostische Güte (T2):**
    -   Zeigt die wichtigsten diagnostischen Gütemaße (Sens, Spez, PPV, NPV, Acc, BalAcc, F1, AUC) für die aktuell **angewendeten und gespeicherten** T2-Kriterien im Vergleich zum N-Status für das global ausgewählte Kollektiv an. Inklusive 95% Konfidenzintervallen.

-   **4.3.5 Auswertungstabelle:**
    -   Ähnlich der Tabelle im Daten-Tab, zeigt aber zusätzlich die Anzahl der positiven/gesamten Lymphknoten für N, AS und die **angewandten** T2-Kriterien pro Patient.
    -   **Detailansicht:** Aufklappbare Zeilen zeigen für jeden T2-Lymphknoten dessen Merkmale und welche der angewandten Kriterien zur Positiv-/Negativ-Bewertung geführt haben. Erfüllte Kriterien werden hervorgehoben.
    -   Sortier- und Paginierfunktionen wie im Daten-Tab.

---
**4.4 Statistik-Tab**
---

Dieser Tab bietet detaillierte statistische Auswertungen.
-   **Layout-Auswahl:**
    -   `Einzelansicht Aktiv`: Analysiert das im globalen Header ausgewählte Kollektiv.
    -   `Vergleich Aktiv`: Ermöglicht die Auswahl zweier spezifischer Kollektive (Kollektiv 1, Kollektiv 2) aus Dropdown-Menüs für einen direkten statistischen Vergleich.
-   **Dargestellte Analysen (als Karten mit Tabellen und z.T. Diagramm-Optionen):**
    -   **Deskriptive Statistik:** Detaillierte demographische und klinische Daten sowie Lymphknoten-Anzahlen für das ausgewählte Kollektiv (bzw. Kollektiv 1 bei Vergleichsansicht).
    -   **Diagnostische Güte AS:** Sensitivität, Spezifität, PPV, NPV, Accuracy, Balanced Accuracy (AUC), F1-Score für das Avocado Sign, jeweils mit 95% Konfidenzintervallen (Wilson Score für Proportionen, Bootstrap Perzentil für BalAcc/AUC/F1 mit 5000 Replikationen).
    -   **Diagnostische Güte T2 (Angewandt):** Dieselben Metriken für die aktuell im Auswertung-Tab angewendeten T2-Kriterien.
    -   **Statistischer Vergleich AS vs. T2 (Angewandt):** Paarweiser Vergleich der Accuracy (mittels McNemar-Test) und der AUC (mittels DeLong-Test) zwischen AS und den angewandten T2-Kriterien. Inklusive p-Werten und Teststatistiken.
    -   **Assoziationen mit N-Status:** Analyse des Zusammenhangs zwischen AS-Status bzw. einzelnen T2-Merkmalen (basierend auf den im Auswertung-Tab definierten Werten, auch wenn das Kriterium dort nicht aktiv ist) und dem pathologischen N-Status. Berechnung von Odds Ratio (OR), Risk Difference (RD), Phi-Koeffizient (φ) mit 95% CIs und p-Werten (Fisher's Exact Test). Zusätzlich Vergleich der medianen LK-Größe zwischen N+ und N- Patienten mittels Mann-Whitney-U-Test.
    -   **Vergleich zweier Kollektive (nur bei Layout 'Vergleich Aktiv'):** Statistischer Vergleich der Accuracy (Fisher's Exact Test) und AUC (Z-Test basierend auf Bootstrap SEs) von AS und den angewandten T2-Kriterien zwischen den beiden ausgewählten Kollektiven.
    -   **Vergleichstabelle verschiedener Kriteriensets:** Tabellarische Gegenüberstellung der Performance (Sens, Spez, PPV, NPV, Acc, AUC/BalAcc) des AS, der aktuell angewandten T2-Kriterien und ausgewählter Literatur-Kriteriensets. Die Literatur-Sets werden auf ihrem spezifischen Zielkollektiv evaluiert.
-   **Dynamische Diagramme:**
    -   Altersverteilung und Geschlechterverteilung für das aktuell betrachtete Kollektiv (bzw. Kollektiv 1).
-   **Tooltips:** Alle statistischen Metriken und Tests werden mit detaillierten Tooltips erklärt, die deren Berechnung, Interpretation und klinische Relevanz erläutern.

---
**4.5 Präsentation-Tab**
---

Dieser Tab dient der aufbereiteten Darstellung von Ergebnissen, ideal für Präsentationen oder schnelle Vergleiche.
-   **Ansichtsauswahl:**
    -   `Avocado Sign (Performance)`: Zeigt eine Übersichtstabelle der AS-Performance (Sens, Spez, PPV, NPV, Acc, AUC mit CIs) stratifiziert nach den Kollektiven Gesamt, Direkt OP und nRCT. Zusätzlich wird eine Tabelle mit Basis-Demographiedaten angezeigt.
    -   `AS vs. T2 (Vergleich)`: Ermöglicht den direkten Vergleich des AS mit einer spezifischen T2-Kriteriumsbasis.
        -   **T2-Basis Auswahl:** Ein Dropdown erlaubt die Auswahl der zu vergleichenden T2-Basis: entweder die aktuell im Auswertung-Tab angewendeten Kriterien oder vordefinierte Kriteriensets aus relevanten Literaturstudien (z.B. Koh et al., Barbaro et al., ESGAR 2016/Rutegård et al.).
        -   **Info-Karte zur T2-Basis:** Zeigt Details zur ausgewählten T2-Studie (Referenz, Patientenkohorte der Originalstudie, Untersuchungstyp, Fokus, Schlüsselkriterien).
        -   **Vergleichstabellen:**
            -   Diagnostische Güte (Sens, Spez, PPV, NPV, Acc, AUC mit CIs) für AS und die ausgewählte T2-Basis, evaluiert auf dem für die T2-Studie relevanten Kollektiv (oder dem globalen Kollektiv, falls anwendbar).
            -   Statistische Tests (McNemar für Accuracy, DeLong für AUC) zum Vergleich von AS vs. T2-Basis.
        -   **Vergleichs-Balkendiagramm:** Visualisiert Sensitivität und Spezifität von AS vs. T2-Basis.
-   **Download-Optionen:** Spezifische Tabellen und Diagramme aus dieser Ansicht können direkt als CSV, Markdown oder PNG/SVG heruntergeladen werden.

---
**4.6 Publikation-Tab**
---

Dieser neu gestaltete und erweiterte Tab ist darauf ausgerichtet, den Nutzer bei der Erstellung einer wissenschaftlichen Publikation im Stil des Journals "Radiology" zu unterstützen.
-   **Sprachauswahl:** Die generierten Inhalte können zwischen Deutsch und Englisch umgeschaltet werden.
-   **Sektionsauswahl (Navigation):** Ermöglicht die Auswahl spezifischer Abschnitte einer Publikation:
    -   **Methoden:** Mit Unterpunkten wie Studiendesign/Ethik, Patientenkohorte, MRT-Protokoll, Bildanalyse (AS, T2), Referenzstandard, Statistische Analyse.
    -   **Ergebnisse:** Mit Unterpunkten wie Patientencharakteristika, Performance AS, Performance Literatur-T2, Performance optimierte T2, Vergleich AS vs. T2.
    -   **Referenzen:** Anzeige der Literaturliste.
-   **Brute-Force Metrik-Auswahl:** Der Nutzer kann auswählen, welche der im Auswertung-Tab optimierbaren Brute-Force-Zielmetriken in den generierten Ergebnis-Texten besonders hervorgehoben werden soll.
-   **Dynamisch generierter Inhalt:** Für den ausgewählten Abschnitt und die gewählte Sprache werden generiert:
    -   **Textvorschläge:** Ausformulierte Textbausteine, die auf den aktuellen Daten, Konfigurationen und etablierten Formulierungen für wissenschaftliche Artikel basieren. Die Texte enthalten Verweise auf Tabellen und Abbildungen (z.B. "[Table 1]", "[Figure 2a]"). Zitationen werden als Schlüssel (z.B. "[Lurz2025]") eingefügt.
    -   **Tabellen:** "Radiology"-konform formatierte Tabellen (generiert durch `radiology_table_renderer.js`) mit detaillierten Ergebnissen, Titeln, Legenden und Fußnoten. Beispiele:
        -   Tabelle 1: Patientencharakteristika.
        -   Tabelle 2: MRT-Sequenzparameter.
        -   Tabelle 3: Übersicht Literatur-T2-Kriterien.
        -   Tabellen 4-6: Diagnostische Güte AS, Literatur-T2, Optimierte-T2.
        -   Tabelle 7: Statistischer Vergleich AS vs. T2.
    -   **Diagramm-Platzhalter:** Container für Diagramme, die dynamisch mit `chart_renderer.js` (oder spezifischen Komponenten wie `consort_diagram_renderer.js`) gefüllt werden. Beispiele:
        -   Abbildung 1: CONSORT-ähnliches Flussdiagramm.
        -   Abbildung 2: Beispielbilder Avocado Sign (Platzhalter, da Bilder nicht in App).
        -   Abbildung 3: ROC-Kurven-Vergleich.
        -   Abbildung 4a-c: Performance-Vergleichs-Balkendiagramme für die Kollektive.
-   **Referenzliste:** Eine formatierte Literaturliste im Vancouver-Stil, basierend auf den in `PUBLICATION_CONFIG` hinterlegten und im Text zitierten Referenzen. Die Zitationen im Text werden durch numerische Marker ersetzt (dies erfordert eine angepasste Logik im `publication_text_generator.js` und `publication_formatters.js`).
-   **DOCX-Export:** Möglichkeit, die generierten Textinhalte des aktuell ausgewählten Hauptabschnitts als formatierte .docx-Datei herunterzuladen.

---
**4.7 Export-Tab**
---

Dieser Tab bündelt alle Exportmöglichkeiten der Anwendung.
-   **Dateinamen-Konvention:** Generierte Dateinamen folgen einem Standardmuster: `AvocadoSignT2_{TYP}_{KOLLEKTIV}_{DATUM}.{EXT}`. Datum und Kollektiv werden dynamisch eingefügt. `{TYP}` wird durch eine spezifische Kennung ersetzt (z.B. `StatistikCSV`, `DatenlisteMD`).
-   **Einzelexporte:**
    -   Statistik-Ergebnisse: CSV, XLSX.
    -   Brute-Force-Bericht: TXT, XLSX (Top Ergebnisse).
    -   Deskriptive Statistik: Markdown.
    -   Datenliste (gefiltert): Markdown, XLSX.
    -   Auswertungstabelle (gefiltert): Markdown, XLSX.
    -   Gefilterte Rohdaten (aktuelles Kollektiv): CSV, XLSX.
    -   Umfassender HTML-Analysebericht: Enthält Konfigurationen, alle Tabellen und Diagramme des Statistik-Tabs für das aktuelle Kollektiv.
    -   Diagramme & Tabellen (als Bilder): ZIP-Archiv mit allen aktuell sichtbaren Diagrammen als PNG und SVG sowie ausgewählten Tabellen als PNG. (Hinweis: Erfasst nur aktuell gerenderte Elemente).
-   **Export-Pakete (ZIP):**
    -   `Gesamtpaket (Alle Dateien)`: Bündelt die wichtigsten Einzel-Exporte (ohne Bild-ZIPs).
    -   `Nur CSVs`, `Nur XLSXs`, `Nur Markdown`.
    -   `Nur Diagramm/Tabellen-PNGs`, `Nur Diagramm-SVGs`.
-   **Hinweise:** Erläuterungen zu den Dateiformaten und deren Verwendungszweck.

=========================================================
5. Statistische Methoden im Detail
=========================================================

Die Anwendung implementiert eine Reihe statistischer Verfahren zur robusten Analyse der Daten:

-   **Deskriptive Statistik:** Median, Mittelwert, Standardabweichung (SD), Minimum, Maximum für kontinuierliche Variablen; absolute und relative Häufigigkeiten für kategoriale Variablen.
-   **Diagnostische Gütemaße:**
    -   Sensitivität (Sens), Spezifität (Spez), Positiver Prädiktiver Wert (PPV), Negativer Prädiktiver Wert (NPV), Accuracy (ACC).
    -   Balanced Accuracy (BalAcc): Mittelwert aus Sensitivität und Spezifität, robust bei ungleichen Klassengrößen.
    -   Area Under the Curve (AUC) der ROC-Kurve: Für binäre Tests (wie AS oder ein festes T2-Set) äquivalent zur Balanced Accuracy.
    -   F1-Score: Harmonisches Mittel aus PPV und Sensitivität.
-   **Konfidenzintervalle (CI):** Standardmäßig 95%-CIs.
    -   Für Proportionen (Sens, Spez, PPV, NPV, ACC): **Wilson Score Intervall**.
    -   Für BalAcc (AUC), F1-Score: **Bootstrap Perzentil Intervall** mit 5000 Replikationen (konfigurierbar in `APP_CONFIG`).
    -   Für Odds Ratio (OR): Woolf Logit Methode mit Haldane-Anscombe Korrektur für Nullen.
    -   Für Risk Difference (RD): Wald-Methode.
-   **Statistische Tests:**
    -   **McNemar-Test:** Zum Vergleich der Accuracy zweier diagnostischer Methoden an gepaarten Daten. Mit Kontinuitätskorrektur bei kleinen Stichproben.
    -   **DeLong-Test:** Zum Vergleich zweier AUC-Werte von gepaarten ROC-Kurven.
    -   **Fisher's Exact Test:** Für 2x2 Kontingenztafeln, insbesondere bei kleinen erwarteten Zellhäufigkeiten, zum Test auf Unabhängigkeit/Assoziation oder zum Vergleich von Raten zwischen unabhängigen Gruppen.
    -   **Mann-Whitney-U-Test:** Nichtparametrischer Test zum Vergleich der zentralen Tendenz zweier unabhängiger Stichproben (z.B. Lymphknotengrößen zwischen N+ und N- Patienten). Mit Normal-Approximation und Bindungskorrektur.
    -   **Z-Test für AUC-Vergleich (unabhängige Stichproben):** Vergleicht AUCs basierend auf deren Werten und Standardfehlern (aus Bootstrap).
-   **Assoziationsmaße:**
    -   **Odds Ratio (OR):** Quantifiziert die Stärke des Zusammenhangs.
    -   **Risk Difference (RD):** Absolute Risikodifferenz.
    -   **Phi-Koeffizient (φ):** Korrelationsmaß für binäre Variablen.
-   **Signifikanzniveau:** Standardmäßig p < 0.05 (konfigurierbar in `APP_CONFIG`). p-Werte werden exakt oder als "< Schwellenwert" (z.B. p < 0,001) angegeben.

Alle Berechnungen erfolgen clientseitig durch die Implementierungen im `statisticsService.js`.

=========================================================
6. Bedienungshinweise
=========================================================

-   **Kollektivauswahl:** Die globale Kollektivauswahl im Header beeinflusst alle Analysen. Stellen Sie sicher, dass das gewünschte Kollektiv gewählt ist.
-   **T2-Kriterien anwenden:** Änderungen an den T2-Kriterien im "Auswertung"-Tab werden erst nach Klick auf "Anwenden & Speichern" systemweit wirksam. Ungespeicherte Änderungen werden visuell markiert.
-   **Brute-Force-Optimierung:** Dieser Prozess kann je nach Datenmenge und Komplexität einige Zeit in Anspruch nehmen. Die Anwendung bleibt währenddessen bedienbar, aber es wird empfohlen, keine größeren Änderungen vorzunehmen. Ein Fortschrittsbalken informiert über den Status.
-   **Tooltips:** Viele Elemente der Benutzeroberfläche (Buttons, Eingabefelder, Spaltenköpfe, Statistikwerte) verfügen über detaillierte Tooltips, die bei Mouseover erscheinen und zusätzliche Informationen und Erklärungen liefern.
-   **Exporte:** Beachten Sie, dass ZIP-Exporte von Diagrammen und Tabellen-PNGs nur die Elemente erfassen, die zum Zeitpunkt des Exports im jeweiligen Tab (Statistik, Auswertung) sichtbar und gerendert sind. Für spezifische Diagramme/Tabellen (z.B. aus dem Präsentation- oder Publikation-Tab) nutzen Sie die direkten Download-Buttons an den Elementen.
-   **Browser-Kompatibilität:** Die Anwendung ist für moderne Browser (Chrome, Firefox, Edge, Safari in aktuellen Versionen) optimiert. Die Verwendung von Web Workern für die Brute-Force-Optimierung erfordert Browser-Unterstützung.

=========================================================
7. Geplante Erweiterungen und Limitationen
=========================================================

-   **Geplante Erweiterungen (Beispiele):**
    -   Import eigener Patientendaten (CSV/Excel).
    -   Erweiterte Konfigurationsoptionen für Diagramm-Styling.
    -   Implementierung weiterer statistischer Tests oder Metriken.
    -   Speichern/Laden von benutzerdefinierten T2-Kriteriensets.
    -   Ausbau der Markdown-zu-DOCX Konvertierung mit besserer Formatierungsübernahme.
    -   Dynamische Nummerierung von Zitationen und Referenzen im Publikationstab nach Reihenfolge des Erscheinens.

-   **Limitationen:**
    -   Die Anwendung ist ein Forschungswerkzeug und nicht für die klinische Routine-Diagnostik validiert oder zugelassen.
    -   Die statistischen Berechnungen, obwohl sorgfältig implementiert, sollten für finale Publikationen kritisch überprüft und ggf. mit etablierter Statistiksoftware (z.B. R, SPSS) validiert werden.
    -   Die Brute-Force-Optimierung findet ein lokales Optimum basierend auf den vordefinierten Schritten und Wertebereichen für Kriterien. Es ist nicht garantiert, dass dies das globale Optimum aller denkbaren Kriterien darstellt.
    -   Der TIFF-Export für Diagramme ist browserseitig nur schwer direkt umsetzbar; hochauflösende PNGs oder SVGs (die in TIFF konvertiert werden können) werden stattdessen angeboten.
    -   Die aktuelle Implementierung des Referenzmanagements im Publikationstab ist rudimentär (feste Nummerierung basierend auf Konfiguration).
